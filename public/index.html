<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dispeƒçink strojvedouc√≠ho MCD</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <div id="loginOverlay" style="position:fixed;z-index:9999;top:0;left:0;width:100vw;height:100vh;background:rgba(30,34,40,0.97);display:flex;align-items:center;justify-content:center;flex-direction:column;">
      <div style="background:#23272a;padding:36px 32px 28px 32px;border-radius:18px;box-shadow:0 8px 32px #0008;display:flex;flex-direction:column;align-items:center;min-width:320px;">
        <img src="/logo.webp" alt="Logo" style="width:72px;height:72px;border-radius:16px;margin-bottom:18px;box-shadow:0 2px 8px #0006;">
        <h2 style="color:#fff;font-size:1.5em;margin-bottom:10px;">P≈ôihl√°≈°en√≠ do MCD</h2>
        <p style="color:#b9bbbe;font-size:1.08em;margin-bottom:22px;text-align:center;">Pro pokraƒçov√°n√≠ se p≈ôihla≈°te p≈ôes Discord.</p>
        <button id="discordLoginBtn" class="discord-login-btn" style="font-size:1.15em;padding:12px 32px;border-radius:9px;box-shadow:0 2px 8px #0004;">üîë P≈ôihl√°sit se p≈ôes Discord</button>
      </div>
    </div>
    <div id="mainContent" style="display:none;">
      <div id="userProfileBar" style="position:fixed;top:18px;right:24px;z-index:1000;display:flex;align-items:center;gap:10px;"></div>
      <header class="header-logo-title">
          <h1>Dispeƒçink strojvedouc√≠ho <span class="mcd-accent">MCD</span></h1>
          <div class="subtitle">Multi-Cargo Doprava &mdash; modern√≠ n√°stroj pro v√Ωbƒõr a spr√°vu vlak≈Ø</div>
      </header>
      <div class="animated-bar"></div>
      <div class="main-rozcestnik">
        <div class="rozcestnik-palette">
          <button class="rozcestnik-toggle">‚ò∞ Otev≈ô√≠t rozcestn√≠k</button>
          <div class="rozcestnik-menu" style="display:none;">
            <a href="/strojvedouci.html" class="rozcestnik-link">üë§ Strojvedouc√≠</a>
            <a href="/index.html" class="rozcestnik-link">üè† Dispeƒçink</a>
          </div>
        </div>
        <div class="rozcestnik-welcome">
          <h2>V√≠tejte v Multi-Cargo Doprava</h2>
          <p>Vyberte si sekci aplikace:</p>
          <ul class="rozcestnik-list">
            <li><a href="/strojvedouci.html" class="rozcestnik-tile">üë§ Strojvedouc√≠</a></li>
            <li><a href="#" class="rozcestnik-tile disabled">üöÑ V√Ωbƒõr vlaku (p≈ôes str√°nku Strojvedouc√≠)</a></li>
          </ul>
        </div>
      </div>
    </div>
    <script>
      // Zjisti, jestli je u≈æivatel p≈ôihl√°≈°en (session v localStorage)
      function isLoggedIn() {
        return localStorage.getItem('discordUser') !== null;
      }
      function showMainContent() {
        document.getElementById('loginOverlay').style.display = 'none';
        document.getElementById('mainContent').style.display = '';
      }
      function showLogin() {
        document.getElementById('loginOverlay').style.display = 'flex';
        document.getElementById('mainContent').style.display = 'none';
      }
      function saveDiscordUserFromUrl() {
        const params = new URLSearchParams(window.location.search);
        if(params.has('discordUser')) {
          try {
            const user = decodeURIComponent(params.get('discordUser'));
            localStorage.setItem('discordUser', user);
            // Odstranit query param z URL (bez reloadu)
            window.history.replaceState({}, document.title, window.location.pathname);
            showMainContent();
          } catch(e) {}
        }
      }
      function renderUserProfile() {
        const bar = document.getElementById('userProfileBar');
        if (!bar) return;
        const userStr = localStorage.getItem('discordUser');
        if (!userStr) { bar.innerHTML = ''; return; }
        let user;
        try { user = JSON.parse(userStr); } catch(e) { bar.innerHTML = ''; return; }
        let avatarUrl = user.avatar
          ? `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png`
          : 'https://cdn.discordapp.com/embed/avatars/0.png';
        bar.innerHTML = `
          <img src="${avatarUrl}" alt="avatar" style="width:36px;height:36px;border-radius:50%;box-shadow:0 2px 8px #0004;">
          <span style="color:#fff;font-weight:600;font-size:1.08em;">${user.username}#${user.discriminator}</span>
        `;
      }
      document.addEventListener('DOMContentLoaded', function() {
        saveDiscordUserFromUrl();
        if(isLoggedIn()) {
          showMainContent();
          renderUserProfile();
        } else {
          showLogin();
        }
        var btn = document.getElementById('discordLoginBtn');
        if(btn) {
          btn.addEventListener('click', function() {
            window.location.href = '/api/discord-login';
          });
        }
      });
      window.addEventListener('storage', function(e) {
        if (e.key === 'discordUser') renderUserProfile();
      });
    </script>

    <footer class="footer">
        &copy; 2025 Multi-Cargo Doprava (MCD) &mdash; design & v√Ωvoj pro strojvedouc√≠
    </footer>
    <script src="/script.js"></script>
</body>
</html>